framework:
    secret: 'test-secret'
    test: true

    messenger:
        failure_transport: failed

        transports:
            # Outbox - stores events in database with binary UUID v7
            outbox:
                dsn: 'doctrine://default?table_name=messenger_outbox&queue_name=outbox'
                serializer: 'Freyr\MessageBroker\Serializer\MessageNameSerializer'
                options:
                    auto_setup: false

            # Inbox - standard Doctrine transport with deduplication middleware
            inbox:
                dsn: 'doctrine://default?table_name=messenger_inbox&queue_name=inbox'
                serializer: 'Freyr\MessageBroker\Serializer\MessageNameSerializer'
                options:
                    auto_setup: true

            # AMQP - use in-memory for testing to avoid external dependencies
            amqp:
                dsn: 'in-memory://'

            # Failed transport
            failed:
                dsn: 'doctrine://default?queue_name=failed'

        routing:
            # Route test events to outbox
            'Freyr\MessageBroker\Tests\Fixtures\Publisher\*': outbox

            # Typed consumer messages go to inbox transport
            'Freyr\MessageBroker\Tests\Fixtures\Consumer\OrderPlacedMessage': inbox

            # Consumer messages are handled directly (no routing to transport)
